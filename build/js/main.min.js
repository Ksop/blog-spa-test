"use strict";function blogSubmitHandler(a){a.preventDefault(),createNavItem(this),this.removeEventListener("submit",blogSubmitHandler)}function setActiveLink(a){document.querySelectorAll(".main-nav__link").forEach(function(a){a.classList.contains("main-nav__link--active")&&a.classList.remove("main-nav__link--active")}),a.classList.add("main-nav__link--active")}function getNavItems(a){var b=new XMLHttpRequest;b.open("GET","/categories",!0),b.send(),b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.responseText);a(c)}}}function renderNav(a){var b,c,d,e=document.getElementById("main-nav-list");e.innerHTML="",a.forEach(function(a){b=a.id,c=a.hash,d=a.name,e.innerHTML+='<li class="main-nav__item"><a data-id="'+b+'" href="#'+c+'" class="main-nav__link">'+d+'</a><div class="main-nav__actions"><button data-action="edit" class="btn  btn--action  btn--edit"></button><button data-action="delete" class="btn  btn--action  btn--delete"></button></div></li>'})}function createNavItem(a){var b=new FormData(a),c=new XMLHttpRequest;c.open("POST","/categories",!0),c.send(b),c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var b=c.responseText;alert(b),getNavItems(function(a){renderNav(a)}),a.elements.blogname.value="",a.elements.hash.value=""}}}function updateNavItem(a,b){var c=new FormData(a),d=new XMLHttpRequest;c.append("id",b),d.open("PUT","/categories/"+b,!0),d.send(c),d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=d.responseText;alert(a),getNavItems(function(a){renderNav(a)})}}}function deleteNavItem(a){var b=new XMLHttpRequest,c="id="+encodeURIComponent(a);b.open("DELETE","/categories/"+a,!0),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(c),b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;alert(a),getNavItems(function(a){renderNav(a)})}}}function postSubmitHandler(a){a.preventDefault(),createPost(this,location.hash.substring(1),document.querySelector(".main-nav__link--active").textContent.toLowerCase()),this.removeEventListener("submit",postSubmitHandler)}function getPosts(a){var b=new XMLHttpRequest,c=location.hash.substring(1);b.open("GET","/posts/"+c,!0),b.send(),b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.responseText);a(c)}}}function renderPosts(a,b){var c,d,e,f,g=document.getElementById("main-content"),h=document.createElement("section"),i=document.createElement("header"),j=a[0].blog.toLowerCase();i.className="posts__header",i.innerHTML='<h2 class="posts__title">'+j+'</h2><div class="posts__action"><button data-action="create" class="btn  btn--add  btn--dark">Добавить пост</button>',h.className="posts",h.setAttribute("id","posts"),h.appendChild(i),g.innerHTML="",g.appendChild(h),"в этом блоге нет записей"!==j&&a.forEach(function(a){c=a.id,d=a.hash,e=a.title,f=a.intro,h.innerHTML+='<article class="post"><span class="post__link" data-id="'+c+'"><h3 class="post__title">'+e+'</h3></span><p class="post__intro">'+f+'</p><div class="post__actions"><button data-action="edit" class="btn  btn--action  btn--edit"></button><button data-action="delete" class="btn  btn--action  btn--delete"></button></div></article>'}),b()}function createPost(a,b,c){var d=new FormData(a),e=new XMLHttpRequest;d.append("hash",b),d.append("blog",c),e.open("POST","/posts",!0),e.send(d),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var b=e.responseText;alert(b),getPosts(function(a){renderPosts(a,function(){postForm.init()})}),a.elements.title.value="",a.elements.intro.value=""}}}function updatePost(a,b){var c=new FormData(a),d=new XMLHttpRequest;c.append("id",b),d.open("PUT","/posts/"+b,!0),d.send(c),d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){var a=d.responseText;alert(a),getPosts(function(a){renderPosts(a,function(){postForm.init()})})}}}function deletePost(a){var b=new XMLHttpRequest,c="id="+encodeURIComponent(a);b.open("DELETE","/posts/"+a,!0),b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.send(c),b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=b.responseText;alert(a),getPosts(function(a){renderPosts(a,function(){postForm.init()})})}}}window.onload=function(){getNavItems(function(a){renderNav(a)})};var mainNav=document.getElementById("main-nav");mainNav.addEventListener("click",function(a){var b=a.target,c=b.dataset.action;c&&blogForm[c](a),"main-nav__link"===b.className&&setActiveLink(b)}),window.addEventListener("hashchange",function(){getPosts(function(a){renderPosts(a,function(){postForm.init()})})});var blogForm={create:function(a){a.preventDefault();var b=document.getElementById("blog-add-form"),c=b.closest(".modal-form-wrapper");this.show(c),b.addEventListener("submit",blogSubmitHandler)},edit:function(a){a.preventDefault();var b=document.getElementById("blog-add-form"),c=b.closest(".modal-form-wrapper"),d=b.elements.blogname,e=b.elements.hash,f=a.target.parentNode.parentNode,g=f.querySelector(".main-nav__item a"),h=g.dataset.id;this.show(c),d.value=g.innerHTML,e.value=g.getAttribute("href").substring(1),b.onsubmit=function(a){a.preventDefault(),updateNavItem(this,h)}},delete:function(a){deleteNavItem(a.target.parentNode.parentNode.querySelector(".main-nav__item a").dataset.id)},show:function(a){var b=a.querySelector("#modal-form-close");a.classList.add("modal-form-wrapper--show"),b.addEventListener("click",this.close)},close:function(a){a.preventDefault(),this.closest(".modal-form-wrapper").classList.remove("modal-form-wrapper--show")}},postForm={init:function(){document.getElementById("posts").onclick=function(a){var b=a.target.dataset.action;b&&postForm[b](a)}},create:function(a){a.preventDefault();var b=document.getElementById("post-add-form"),c=b.closest(".modal-form-wrapper");this.show(c),b.addEventListener("submit",postSubmitHandler)},edit:function(a){a.preventDefault();var b=document.getElementById("post-edit-form"),c=b.closest(".modal-form-wrapper"),d=b.elements.title,e=b.elements.intro,f=a.target.parentNode.parentNode,g=f.querySelector(".post__link"),h=f.querySelector(".post__intro"),i=g.dataset.id;this.show(c),d.value=g.textContent,e.value=h.textContent,b.onsubmit=function(a){a.preventDefault(),updatePost(this,i)}},delete:function(a){deletePost(a.target.parentNode.parentNode.querySelector(".post__link").dataset.id)},show:function(a){var b=a.querySelector(".modal-form-close");a.classList.add("modal-form-wrapper--show"),b.addEventListener("click",this.close)},close:function(a){a.preventDefault(),this.closest(".modal-form-wrapper").classList.remove("modal-form-wrapper--show")}};